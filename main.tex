\documentclass[notwoside, 11pt]{ltjsarticle}

\usepackage{lipsum} % ダミーテキスト用

\usepackage{titlesec} % タイトルのカスタマイズ用
\usepackage{tcolorbox} %
\usepackage{xcolor} % 色指定用
\usepackage{tocloft} % 目次カスタマイズ用
\usepackage{etoolbox} % 目次ページ番号の制御
\usepackage{chappg}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% デフォルトの余白設定
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[top     =20truemm,
            bottom  =18truemm,
            left    =23truemm,
            right   =23truemm]{geometry}
\setlength{ \topmargin }    { -20mm }
\setlength{ \headheight }   {  23mm }
\setlength{ \headsep }      { -8mm }
\setlength{ \footskip }     { 18pt }




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ページスタイルの設定
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{} % 全てのヘッダー・フッターをクリア
\renewcommand{\headrulewidth}{0pt} % デフォルトのヘッダー罫線を非表示
\renewcommand{\footrulewidth}{0.4pt} % フッターに罫線を表示
% ヘッダーの表記：章番号と章タイトル
\fancyhead[L]{} % ヘッダー左側：なし
\fancyhead[C]{%
  \begin{tcolorbox}[colback=gray!100, colframe=black, sharp corners, 
                      boxrule=0pt, toprule=0.5pt, bottomrule=0.5pt, 
                      width=\linewidth, boxsep=0pt ]
    \centering\bfseries\ttfamily\textcolor{white}{\thesection 章\ \leftmark}
  \end{tcolorbox}
}
\fancyhead[R]{} % ヘッダー右側：なし
% フッター部分の設定
\usepackage{etoolbox} % 目次ページ番号の制御
\renewcommand{\thepage}{
  \ifnum\value{section}=0
    S-\arabic{page}
  \else
    \ifnum\value{section}>0
      \thesection-\arabic{page}
    \fi
  \fi
} % ページ番号の表示形式を変更
\fancyfoot[L]{} % フッター左側：なし
\fancyfoot[C]{\bfseries\ttfamily\thepage} % ページ番号
\fancyfoot[R]{} % フッター右側：なし
%目次用のヘッダフッタ
\fancypagestyle{StyleTOC}{
  \fancyhf{}            % 既存のヘッダー・フッター設定をクリア
  \fancyhead[C]{%
    \begin{tcolorbox}[colback=gray!100, colframe=black, sharp corners, 
                      boxrule=0pt, toprule=0.5pt, bottomrule=0.5pt, 
                      width=\linewidth, boxsep=0pt ]
      \centering\bfseries\ttfamily\textcolor{white}{目\hspace{3em}次}
    \end{tcolorbox}
  }
  \fancyfoot[C]{} % ページ番号：なし
  \renewcommand{\headrulewidth}{0pt} % デフォルトのヘッダー罫線を非表示
  \renewcommand{\footrulewidth}{0pt} % フッターに罫線を表示    
}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% sectionの再定義
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% ごあいさつ用のsection
\newcommand{\sectionA}[1]{%
  \hspace{2em}
  \thispagestyle{empty} % ページスタイルをemptyに設定
  \begin{center}%
    {\fontsize{18pt}{18pt}\selectfont\bfseries ≪\hspace{0.5em}#1\hspace{0.5em}≫}%
  \end{center}
  \setcounter{section}{-2}  % 章番号をリセット
  \addcontentsline{toc}{section}{#1} % ページ番号なし
}

%% 目次用のセクション:
\newcommand{\sectionB}[1]{
  \cleardoublepage
  \newgeometry{top=80truemm, bottom=18truemm, left=23truemm, right=23truemm}
  \thispagestyle{empty} % 目次の見出しページスタイルをemptyに設定
  \phantomsection % hyperref のためのアンカー
  \markboth{#1}{} % ヘッダーにタイトルを表示
  \begin{tcolorbox}[colback=gray!20, colframe=black, sharp corners,
      top=5mm, left=0mm, bottom=5mm, right=0mm,
      boxrule=0pt, toprule=1.5pt, bottomrule=1.5pt,
      width=\linewidth ]
    \fontsize{34pt}{34pt}\selectfont\bfseries\gtfamily\centering #1
  \end{tcolorbox}
  \setcounter{section}{-1}  % 章番号をリセット
  \addcontentsline{toc}{section}{#1} % ページ番号なし
  \newpage  % 改ページ
  \restoregeometry  % ページレイアウトを元に戻す
}

% 目次以降のセクション
\newcommand{\sectionC}[1]{
  \cleardoublepage % 改ページ
  \newgeometry{top=80truemm, bottom=18truemm, left=23truemm, right=23truemm}
  \thispagestyle{empty} % ページスタイルをemptyに設定
  \phantomsection % hyperref のためのアンカー
  \refstepcounter{section}  % 章番号をインクリメント
  \markboth{#1}{} % ヘッダーにタイトルを表示
  \begin{tcolorbox}[colback=gray!20, colframe=black, sharp corners,
      top=5mm, left=0mm, bottom=5mm, right=0mm,
      boxrule=0pt, toprule=1.5pt, bottomrule=1.5pt,
      width=\linewidth ]
    \ifstrequal{#1}{安全上の注意事項}
    {\fontsize{34pt}{34pt}\selectfont\bfseries\gtfamily\centering #1}
    {\fontsize{34pt}{34pt}\selectfont\bfseries\gtfamily\centering \thesection\ 章\ #1}
  \end{tcolorbox}
  \newpage  % 改ページ
  \setcounter{page}{1} %
  \restoregeometry  % ページレイアウトを元に戻す
  \ifstrequal{#1}{安全上の注意事項}
  {\addcontentsline{toc}{section}{#1}}% ページ番号を追加
  {\addcontentsline{toc}{section}{\thesection\ 章\ #1}}% ページ番号を追加
}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 目次部分の修正
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\contentsname}{} % 目次表記削除
\usepackage{titletoc}
%sectionの調整
% \titlecontents{section}
%   [0pt]% インデント
%   {\bfseries \large}%項目の前に実行するコード
%   {\thesection\quad}%ラベル (番号) の書式
%   {\hfill\textup{P=}\thepage}%項目名とページ番号の間の詰め物とページ番号の書式
%   {}%項目の後に実行するコード

%   \titlecontents{subsection}
%   [0pt]% インデント
%   {\bfseries \large}%項目の前に実行するコード
%   {\thesubsection\quad}%ラベル (番号) の書式
%   {\hfill\textup{P=}\thepage}%項目名とページ番号の間の詰め物とページ番号の書式
%   {}%項目の後に実行するコード



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% しおりの設定
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{hyperref}
\hypersetup{%
  dvipdfmx,%
  setpagesize=false,%
  bookmarks=true,%しおりの作成
  bookmarksdepth=subsection,%しおりの深さ subsectionまで
  bookmarksnumbered=true,%PDFのしおりに節番号も含めるか
  colorlinks=false,%リンクのテキストに色をつけるかどうか
  pdfstartview={Fit}, %表示レイアウト
  pdftitle={},%PDFのメタタイトル情報
  pdfsubject={},%PDFのメタ主題情報。
  pdfauthor={},%PDFのメタ著者情報。
  pdfkeywords={},%PDFのメタキーワード情報。複数キーワードはセミコロンで区切る。
  pdfcreator={}%PDFの作成者情報
}






\begin{document}


\sectionA{ごあいさつ}
テストページ 1


\sectionA{整備とサービスについて}
テストページ 2


\sectionB{目次}
\tableofcontents
\thispagestyle{StyleTOC} 



\sectionC{安全上の注意事項}
テストページ 3
\newpage
\lipsum[1-3] % ダミーテキスト（不要なら削除）



\sectionC{機械の概要}
テストページ 3
\newpage
\lipsum[1-3] % ダミーテキスト（不要なら削除）


\sectionC{主要諸元}
テストページ 3
\newpage
\lipsum[1-3] % ダミーテキスト（不要なら削除）


\sectionC{標準付属品}
\subsection{test}
テストページ 3
\newpage
\lipsum[1-3] % ダミーテキスト（不要なら削除）


\end{document}
